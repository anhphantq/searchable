<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-barstyle" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mmenu">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Mmenu">
    <!-- <meta name="theme-color" content="#999999" class="next-head" />
    <meta name="msapplication-TileColor" content="#999999" class="next-head" /> -->
    <title>Lucene search</title>
    <link href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css' rel='stylesheet'>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    <title>Stock prediction</title>
    <style>
      #app-header {
        padding: 21px 16px;
      }

      #search-container {
        height: 36px;
        border-radius: 8px;
        position: relative;
      }

      #app-header .input-search {
        border: 0;
        background-color: #f1f1f1;
        width: 100%;
        height: 36px;
        border-radius: 8px;
        padding-left: 12px;
      }

      #app-header .btn-search {
        position: absolute;
        border: 0;
        right: 6px;
        top: 2px;
      }

      .result-item {
        border: solid 1px;
        margin: 10px;
        padding: 5px;
      }
    </style>
  </head>

  <body>
    
    <div id="app-header">
      <div id="search-container">
        <input id="input-search" type="text" oninput="search(this)" placeholder="search" class="input-search" />
        <button class="submit btn-search"><img class="icon" src="{{ url_for('static', filename='images/search_red.svg') }}"></button>
      </div>
    </div>
    <div id="app-main">
      <div id="search-output-placeholder">
      </div>
    </div>
    <script>
      function debounce(func, wait, immediate) {
        var timeout;
        return function() {
          var context = this, args = arguments;
          var later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
          };
          var callNow = immediate && !timeout;
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
          if (callNow) func.apply(context, args);
        };
      };

      function updateSearchResult(query) {
        if (!query) return;
        $.ajax({
          type: 'GET',
          url: `http://0.0.0.0:8001/search?query=${query}`,
          success: function(data){
            placeholder = $('#search-output-placeholder');

            data = data || [];
            html = '';
            data.forEach(function(searchItem) {
              html += `<div class="result-item">
                <a style="color: black;" href="${searchItem.link}">
                  <div>Score: ${searchItem.score}</div>
                  <div>${searchItem.link}</div>
                </a>
              </div>`
            });
            
            placeholder.html(html);
          }
        })
      }

      const updateResultDebouncer = debounce(updateSearchResult, 300, false);

      function search(thisEle) {
        inputSearchValue = thisEle.value
        updateResultDebouncer(inputSearchValue)
      }

    </script>
  </body>
</html>